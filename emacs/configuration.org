
#+STARTUP: showall

* Aide en ligne

C-h i   : lecteur info (très pratique)
C-h r   : manuel emacs en mode info
C-h C-h : aide sur l’aide en ligne
C-h f   : aide de la fonction donnée
C-h k   : aide de la séquence de touches donnée
C-h v   : aide de la variable donnée
C-h m   : aide sur le mode majeur & les modes mineurs courant

Début de séquence de touches puis « C-h » :
liste de toutes les séquences de touches
commençant par celle donnée

C-h a : commandes dont les noms correspondent à un motif donné
C-h b : tous les keybindings
C-h c : commande lancée par la séquence de touche donnée
C-h C : système de coding
C-h d : fonctions, variables, etc, dont les noms correspondent à un motif donné
C-h e : messages (echo area)
C-h F : aide de la commande donnée
C-h K : aide de la commande liée à la séquence de touches donnée
C-h n : changements récents dans emacs
C-h p : paquet correspondant à un mot clé
C-h P : décrit le paquet donné
C-h s : table de syntaxe courante
C-h S : section info du symbole courant
C-h t : tutoriel
C-h w : quelle séquence de touche lance la commande donnée ?
C-h . : aide correspondant au point courant dans l’echo area
C-h C-a : information à propos d’emacs
C-h C-f : emacs FAQ
C-h C-p : known problems


* Historique

Minibuffer :

M-p, ‘up’ (‘previous-history-element’) – retrieve the input before the one currently in the minibuffer
M-n, ‘down’ (‘next-history-element’) – retrieve the input after the one currently in the minibuffer

M-r (‘previous-matching-history-element’) – Move to an earlier item in the minibuffer history that matches a regexp you enter.

M-s (‘next-matching-history-element’) – Move to a later item in the minibuffer history that matches a regexp you enter.


* Démarrage

#+begin_src emacs-lisp

(setq inhibit-startup-message t)
(setq inhibit-splash-screen t)
(setq inhibit-startup-screen t)

(setq initial-buffer-choice t)

;(setq initial-scratch-message "")

(setq initial-buffer-choice (lambda ()
    (org-agenda-list 30)
    (get-buffer "*Org Agenda*")))

#+end_src


* Configuration automatique

Fichier utilisé par customize

#+begin_src emacs-lisp

(setq custom-file "~/racine/config/edit/emacs/customiseur.el")
(load custom-file)

#+end_src


* Info

#+begin_src emacs-lisp

(setq Info-use-header-line t)
(setq Info-hide-note-references t)

(setq Info-scroll-prefer-subnodes nil)

(setq Info-isearch-search t)

(setq Info-enable-active-nodes nil)

#+end_src


* Serveur

#+begin_src emacs-lisp

(require 'server)

(unless (server-running-p) (server-start))

#+end_src


* Édition


** Indentation

#+begin_src emacs-lisp

(setq indent-tabs-mode t)

(setq standard-indent 4)
(setq tab-width 4)

(setq c-basic-offset 4)

#+end_src


** Format

#+begin_src emacs-lisp

(add-hook 'before-save-hook 'delete-trailing-whitespace)

; Mode texte en auto-fill par défaut (créé une nouvelle ligne  entre deux mots à
; chaque fois que la ligne courant devient trop longue)

(add-hook 'text-mode-hook 'turn-on-auto-fill)

; en Americain, les phrases (sentences) se terminent par deux espaces
; ce comportement n'est pas souhaitable en francais

(setq sentence-end-double-space nil)

; Eviter que la cesure de fin de ligne, operée par exemple par le
; mode autofill ou par un M-q, coupe au niveau d'un caractere ( ou :

(add-hook 'fill-no-break-predicate 'fill-french-nobreak-p)

#+end_src


** Recherche & Remplacement

#+begin_src emacs-lisp

; Wrap search

(setq isearch-wrap-function nil)

(setq search-default-mode #'char-fold-to-regexp)

(setq replace-char-fold t)

#+end_src


** Confirmation

#+begin_src emacs-lisp

; y / n au lieu de yes / no

;(fset 'yes-or-no-p 'y-or-n-p)

(defalias 'yes-or-no-p 'y-or-n-p)

#+end_src


* Répertoires

#+begin_src emacs-lisp

(require 'dired-x)

(require 'dired-aux)

(require 'wdired)

(setq wdired-allow-to-change-permissions t)

(setq default-directory "~/racine")

(setq delete-by-moving-to-trash t)

(setq trash-directory "~/racine/trash/Emacs")

(setq dired-listing-switches "--time-style=iso -lhDF")

(setq ls-lisp-dirs-first t)

(setq dired-ls-F-marks-symlinks t)

(setq dired-recursive-copies 'always)
(setq dired-recursive-deletes 'always)

(add-hook 'dired-mode-hook 'auto-revert-mode)

(setq dired-listing-switches "-lha")

(setq-default dired-omit-files-p t) ; this is buffer-local variable

;; (setq dired-omit-files
;;     (concat dired-omit-files "^\\..*\\.un~"))

(setq dired-omit-files "^\\..*\\.un~")

(setq
 wdired-allow-to-change-permissions t
 wdired-allow-to-redirect-links t
 )

#+end_src


* Tampons (buffers)


** Tampon contenant la liste des tampons

#+begin_src emacs-lisp

(autoload 'ibuffer "ibuffer" "List buffers." t)

#+end_src


* Historique


** Sauvegarde

#+begin_src emacs-lisp

(setq savehist-file
 (concat (getenv "HOME") "/racine/dotdir/emacs.d/hist/savehist"))

(setq savehist-autosave-interval 300)

(setq save-place-file
 (concat (getenv "HOME") "/racine/dotdir/emacs.d/hist/saveplace"))

(setq-default save-place t)

; Important de placer le require après la définition des variables

(require 'saveplace)

(savehist-mode 1)

#+end_src


** Fichiers récents

#+begin_src emacs-lisp

(setq recentf-max-saved-items 1234)
(setq recentf-max-menu-items 1234)

(setq recentf-save-file
 (concat (getenv "HOME") "/racine/dotdir/emacs.d/hist/recentf"))

; Important de placer le require après la définition des variables

(require 'recentf)

(recentf-mode 1)

#+end_src


* Contrôle de version

#+begin_src emacs-lisp

(require 'vc)

#+end_src


* Terminal & Shell


** ANSI

#+begin_src emacs-lisp

(autoload 'ansi-color-for-comint-mode-on "ansi-color" nil t)
(add-hook 'shell-mode-hook 'ansi-color-for-comint-mode-on)

#+end_src


** Shell bash, zsh, etc

#+begin_src emacs-lisp

(setq explicit-shell-file-name "/bin/bash")
(setq shell-file-name "bash")

(defun comint-delchar-or-eof-or-kill-buffer (arg)
  (interactive "p")
  (if (null (get-buffer-process (current-buffer)))
      (kill-buffer)
    (comint-delchar-or-maybe-eof arg)))

(add-hook 'shell-mode-hook
          (lambda ()
            (define-key shell-mode-map
              (kbd "C-d") 'comint-delchar-or-eof-or-kill-buffer)))

#+end_src


** Eshell


*** Visual commands

(require 'eshell)
(require 'em-smart)

(setq eshell-where-to-jump 'begin)
(setq eshell-review-quick-commands nil)
(setq eshell-smart-space-goes-to-end t)


* Courriel


** Données

#+begin_src emacs-lisp

(setq user-mail-address "toto@tutu.org")
(setq user-full-name "Full Name")

#+end_src


** Receive

#+begin_src emacs-lisp

;(setq mail-sources '((pop :server "pop.provider.org" :user "you" :password "secret")))

#+end_src


** Send

#+begin_src emacs-lisp

(setq smtpmail-default-smtp-server "smtp.server.org")
(setq smtpmail-smtp-server "smtp.server.org")

(setq smtpmail-local-domain "server.org")

;(setq smtpmail-auth-credentials '(("hostname" "port" "username" "password")))
;(setq smtpmail-starttls-credentials '(("hostname" "port" nil nil)))

(load-library "smtpmail")

(setq send-mail-function 'smtpmail-send-it)

(setq message-send-mail-function 'smtpmail-send-it)

#+end_src


** Read

Pour lire ses mails dans emacs : M-x rmail

#+begin_src emacs-lisp

(setq rmail-preserve-inbox t)

(setq rmail-primary-inbox-list
      '("/var/spool/mail/<user>" "~/mbox"))

(setq rmail-ignored-headers
      (concat rmail-ignored-headers
	      "\\|^x-.*:\\|^IronPort-PHdr.*:\\|^Received.*:\\|^DKIM.*:"))

#+end_src


** Impression

#+begin_src emacs-lisp

;; Options génériques

(setq lpr-switches '("-o number-up=2" "-o Duplex=DuplexTumble"))

;; Avec lpr

;; (setq lpr-command "lpr")

;; (setq printer-name "Printer_Name")

;; Avec lp

(setq lpr-command "lp")

(setq printer-name nil)

(setq lpr-add-switches nil)

#+end_src


* Présentation


** Taille de la fenêtre

#+begin_src emacs-lisp

(defun perso-taille-fenetre ()
  (interactive)
  (if window-system
  (progn
    ;; use 120 char wide window for largeish displays
    ;; and smaller 80 column windows for smaller displays
    ;; pick whatever numbers make sense for you
    ;; 1280
    (if (> (x-display-pixel-width) 700)
           (add-to-list 'default-frame-alist (cons 'width 140)))
    ;; for the height, subtract a couple hundred pixels
    ;; from the screen height (for panels, menubars and
    ;; whatnot), then divide by the height of a char to
    ;; get the height we want
    (add-to-list 'default-frame-alist
         (cons 'height (/ (- (x-display-pixel-height) 200)
                             (frame-char-height)))))))

(add-hook 'after-init-hook 'perso-taille-fenetre)

(add-hook 'before-make-frame-hook
          #'(lambda ()
              (add-to-list 'default-frame-alist '(left   . 193))
              (add-to-list 'default-frame-alist '(top    . 0))
              (add-to-list 'default-frame-alist '(height . 37))
              (add-to-list 'default-frame-alist '(width  . 140))))

#+end_src


** Police

#+begin_src emacs-lisp

(set-frame-font "Monospace-11")

#+end_src


*** Tester avec xfontsel

#+begin_src emacs-lisp

;(set-face-font 'default "-adobe-avant garde gothic-book-r-normal-*-17-120-100-100-p-*-*-*")

#+end_src


** Curseur

#+begin_src emacs-lisp

(blink-cursor-mode t)

(global-hl-line-mode 1)

#+end_src


** Menus

#+begin_src emacs-lisp

(if (fboundp 'menu-bar-mode) (menu-bar-mode -1))

#+end_src


** Lignes et colonnes

#+begin_src emacs-lisp

(require 'linum)
(global-linum-mode 1)

(setq line-number-display-limit nil)
(line-number-mode t)

(column-number-mode t)

(global-hl-line-mode 1) ; turn on highlighting current line

#+end_src


** Barres de défilement

#+begin_src emacs-lisp

(if (fboundp 'scroll-bar-mode) (scroll-bar-mode -1))
(if (fboundp 'horizontal-scroll-bar-mode) (horizontal-scroll-bar-mode -1))

;(toggle-scroll-bar nil)
;(toggle-horizontal-scroll-bar nil)

;(when (equal window-system 'x) (scroll-bar-mode -1))

(setq	scroll-step 1
	scroll-margin 7
	scroll-conservatively 100000
	scroll-up-agressively 0.01
	scroll-down-agressively 0.01
	scroll-preserve-screen-position 1
	auto-window-vscroll nil
)

(setq-default
	scroll-up-agressively 0.01
	scroll-down-agressively 0.01
)

(setq mouse-wheel-scroll-amount '(5 ((shift) . 10))) ; one line at a time
(setq mouse-wheel-progressive-speed nil)            ; don't accelerate scrolling
(setq mouse-wheel-follow-mouse 't)                  ; scroll window under mouse
(setq scroll-step 1)                                ; keyboard scroll one line at a time

#+end_src


** Coloration syntaxique

#+begin_src emacs-lisp

; Activer la coloration syntaxique
(global-font-lock-mode t)

;;(setq font-lock-maximum-decoration '((c-mode . 1) (t . 2)))

(setq font-lock-maximum-decoration t)

#+end_src


** Barre d'outil

#+begin_src emacs-lisp

(if (fboundp 'tool-bar-mode) (tool-bar-mode -1))

;(when (equal window-system 'x) (tool-bar-mode -1))

#+end_src


** Minibuffer

#+begin_src emacs-lisp

;(setq resize-mini-windows "grow-only")
(setq resize-mini-windows t)

(setq max-mini-window-height 3)

#+end_src


** Beep

#+begin_src emacs-lisp

(setq visible-bell 1)
(setq visible-bell 'top-bottom)

#+end_src


** Thème

#+begin_src emacs-lisp

(when (equal window-system nil) (load-theme 'couleur-term t))

(if (daemonp)
  (add-hook 'after-make-frame-functions
    '(lambda (frame)
     (with-selected-frame frame
       (when (equal window-system 'x) (load-theme 'couleur-gui t))
       )))
  (when (equal window-system 'x) (load-theme 'couleur-gui t))
)

#+end_src


* Aliases

#+begin_src emacs-lisp

(defalias 'eb 'eval-buffer)

#+end_src


* Fonctions


** Sauve ligne

#+begin_src emacs-lisp

(defun sauve-ligne ()
 "Sauve la ligne"
 (interactive)
 (kill-whole-line)
 (undo-boundary)
 (undo)
 )

#+end_src


** Sauve jusque fin ligne

#+begin_src emacs-lisp

(defun sauve-jusque-fin-ligne ()
 "Sauve la ligne"
 (interactive)
 (kill-line)
 (undo-boundary)
 (undo)
 )

#+end_src


** Efface contenu ligne

#+begin_src emacs-lisp

(defun efface-contenu-ligne ()
 "Efface le contenu de la ligne"
 (interactive)
 (kill-line 0)
 (kill-line)
 )

#+end_src


** Efface jusque début ligne

#+begin_src emacs-lisp

(defun efface-jusque-debut-ligne ()
"kill from point to start of line"
(interactive)
(kill-line 0)
)

#+end_src


** Affiche nom fichier

#+begin_src emacs-lisp

(defun affiche-nom-fichier ()
  "Show the full path file name in the minibuffer."
  (interactive)
  (message (buffer-file-name))
  (kill-new (file-truename buffer-file-name))
  )

#+end_src


** Tampon précédent

#+begin_src emacs-lisp

(defun tampon-precedent ()
 "Va au tampon précédent"
 (interactive)
 (switch-to-buffer nil)
 )

#+end_src


** Insertion date

#+begin_src emacs-lisp

(defun insertion-date () (interactive)
  (insert (shell-command-to-string "echo -n $(date +'%d %b %Y')")))

#+end_src


** Insertion date jour

#+begin_src emacs-lisp

(defun insertion-date-jour () (interactive)
  (insert (shell-command-to-string "echo -n $(date +'%a %d %b %Y')")))

#+end_src


** Insertion date jour heure

#+begin_src emacs-lisp

(defun insertion-date-jour-heure () (interactive)
  (insert (shell-command-to-string "echo -n $(date +'%H : %M %a %d %b %Y')")))

#+end_src


** Lignes vides simples

#+begin_src emacs-lisp

(defun lignes-vides-simples ()

  (interactive)

  (goto-char (point-min))

  (while (re-search-forward "\\(^\\s-*$\\)\n" nil t)
    (replace-match "\n")
    (forward-char 1))

  (goto-char (point-min))
)

#+end_src


** Lignes doubles avant titres

#+begin_src emacs-lisp

(defun lignes-doubles-avant-titres ()

  (interactive)

  (goto-char (point-min))

  (while (re-search-forward "\\(^\\*+ \\)" nil t) ;
    (replace-match (concat "\n" (match-string 1)) t nil))

  (goto-char (point-min))
)

#+end_src


** Autres

#+begin_src emacs-lisp

(require 'personnel-fonction "fonction")

#+end_src


* Bindings


** Modificateurs

X-Y, où X est un des éléments de la liste ci-dessous :

S = Shift
C = Control
M = Meta
A = Alt
s = Super
H = Hyper


** Exécution de fonction intéractive

#+begin_src emacs-lisp

;;(global-set-key (kbd "M-:") 'execute-extended-command)
;;(global-set-key (kbd "M-;") 'keyboard-quit)
;;(define-key minibuffer-local-map (kbd "M-;") 'minibuffer-keyboard-quit)

#+end_src


** Quitter

Client et server

#+begin_src emacs-lisp

(global-set-key (kbd "H-a H-z") 'save-buffers-kill-emacs)

#+end_src


** Fichiers

#+begin_src emacs-lisp

;;(global-set-key (kbd "s-*") 'find-name-dired)

#+end_src


** Navigation

#+begin_src emacs-lisp

(global-set-key [kp-prior] 'scroll-down-command)
(global-set-key [prior]    'scroll-down-command)

(global-set-key [kp-next]  'scroll-up-command)
(global-set-key [next]     'scroll-up-command)

(global-set-key [C-home]      'beginning-of-line)
(global-set-key [C-end]      'end-of-line)

(global-set-key [home]      'beginning-of-buffer)
(global-set-key [end]      'end-of-buffer)

#+end_src


** Signets

#+begin_src emacs-lisp

; (global-set-key (kbd "<f1> a")   'bookmark-set)
; (global-set-key (kbd "<f1> b")   'bookmark-bmenu-list)

#+end_src


** Insertion

#+begin_src emacs-lisp

(global-set-key [insert]    'overwrite-mode)
(global-set-key [kp-insert] 'overwrite-mode)

#+end_src


** Complétion

#+begin_src emacs-lisp

(setq hippie-expand-try-functions-list
	'(
		try-expand-dabbrev
		try-expand-dabbrev-all-buffers
		try-expand-dabbrev-from-kill
		try-expand-all-abbrevs
		try-expand-list
		try-expand-line
		try-complete-file-name-partially
		try-complete-file-name
		try-complete-lisp-symbol-partially
		try-complete-lisp-symbol
	)
)

;; (global-set-key (kbd "M-/") 'hippie-expand)
;; (global-set-key (kbd "TAB") 'hippie-expand)

(global-set-key (kbd "<H-tab>") 'hippie-expand)

#+end_src


** Copier & Coller

#+begin_src emacs-lisp

(global-set-key (kbd "<C-insert>")   'sauve-ligne)

(global-set-key (kbd "s-k")   'sauve-jusque-fin-ligne)

(global-set-key (kbd "s-w")   'efface-contenu-ligne)

(global-set-key (kbd "M-k")   'efface-jusque-debut-ligne)

(global-set-key (kbd "<s-backspace>")   'kill-whole-line)

#+end_src


** Rectangle

#+begin_src emacs-lisp

(global-set-key (kbd "<C-return>") 'cua-rectangle-mark-mode)
(global-set-key (kbd "<H-return>") 'cua-rectangle-mark-mode)

#+end_src

CUA mode est mieux

#+begin_src emacs-lisp

;(global-set-key (kbd "H-r") 'string-insert-rectangle)
;(global-set-key (kbd "H-s-r") 'string-rectangle)

#+end_src


** Labels (etags, emacs tags)

Voir Helm dans la configuration des paquets

#+begin_src emacs-lisp

;(global-set-key (kbd "M-*") 'find-tag)

;(global-set-key (kbd "M-,") 'pop-tag-mark)
;(global-set-key (kbd "M-.") 'tags-loop-continue)

#+end_src


** Recherche & Remplacement

#+begin_src emacs-lisp

;(define-key isearch-mode-map (kbd "M-p") 'isearch-ring-retreat)
;(define-key isearch-mode-map (kbd "M-n") 'isearch-ring-advance)

(global-set-key (kbd "s-r") 'rgrep)

#+end_src


** Annulation

#+begin_src emacs-lisp

(global-unset-key (kbd "C-z"))

(global-set-key (kbd "C-z" ) 'undo)

#+end_src


** Répétition

#+begin_src emacs-lisp

(global-set-key (kbd "s-7") 'repeat)

#+end_src


** Fenêtres

Voir aussi hydra dans la configuration des paquets

#+begin_src emacs-lisp

(global-set-key (kbd "s-0") 'delete-window)
(global-set-key (kbd "s-1") 'delete-other-windows)
(global-set-key (kbd "s-2") 'split-window-below)
(global-set-key (kbd "s-3") 'split-window-right)
(global-set-key (kbd "s-5") 'other-window)

(global-set-key (kbd "<s-kp-0>") 'delete-window)
(global-set-key (kbd "<s-kp-1>") 'delete-other-windows)
(global-set-key (kbd "<s-kp-2>") 'split-window-below)
(global-set-key (kbd "<s-kp-3>") 'split-window-right)
(global-set-key (kbd "<s-kp-5>") 'other-window)

(when (fboundp 'windmove-default-keybindings) (windmove-default-keybindings))

(global-set-key (kbd "<s-up>") 'windmove-up)
(global-set-key (kbd "<s-down>") 'windmove-down)
(global-set-key (kbd "<s-right>") 'windmove-right)
(global-set-key (kbd "<s-left>") 'windmove-left)

(global-set-key (kbd "<f12> f") 'follow-mode)

#+end_src


** Historique

#+begin_src emacs-lisp

;(global-set-key (kbd "H-r" ) 'recentf-open-files)

(define-key minibuffer-local-map (kbd "M-p") 'previous-history-element)
(define-key minibuffer-local-map (kbd "M-n") 'next-history-element)

(define-key minibuffer-local-map (kbd "<C-M-p>") 'previous-complete-history-element)
(define-key minibuffer-local-map (kbd "<C-M-n>") 'next-complete-history-element)

#+end_src


** Tampons

#+begin_src emacs-lisp

;; Informations sur le tampon courant

(global-set-key [f6] 'affiche-nom-fichier)

;; Lancer et répondre "!" pour sauver tous les tampons modifiés
;;(global-set-key (kbd "C-x s") 'save-some-buffers)

(define-key global-map [remap list-buffers] 'ibuffer)

(global-set-key (kbd "C-^") 'tampon-precedent)

#+end_src


** Expressions

#+begin_src emacs-lisp

(global-set-key (kbd "C-=") 'eval-expression)

#+end_src


** Orthographe

#+begin_src emacs-lisp

(global-set-key (kbd "<f12> o") 'flyspell-mode)

; Espaces
(global-set-key (kbd "<f12> s") 'whitespace-mode)

#+end_src


** Tampon précédent & suivant

#+begin_src emacs-lisp

(defadvice next-buffer (after avoid-messages-buffer-in-next-buffer)
  (when (string= "*scratch*" (buffer-name)) (next-buffer))
  (when (string= "*Messages*" (buffer-name)) (next-buffer))
  (when (string= "*Completions*" (buffer-name)) (next-buffer))
  (when (string= "*compilation*" (buffer-name)) (next-buffer))
  (when (string= "*Help*" (buffer-name)) (next-buffer))
  (when (string= "*Ibuffer*" (buffer-name)) (next-buffer))
  (when (string-match "TAGS.*" (buffer-name)) (next-buffer))
  (when (string-match "\*helm.*\*" (buffer-name)) (next-buffer)))

(ad-activate 'next-buffer)

(defadvice previous-buffer (after avoid-messages-buffer-in-previous-buffer)
  (when (string= "*scratch*" (buffer-name)) (previous-buffer))
  (when (string= "*Messages*" (buffer-name)) (previous-buffer))
  (when (string= "*Completions*" (buffer-name)) (previous-buffer))
  (when (string= "*compilation*" (buffer-name)) (previous-buffer))
  (when (string= "*Help*" (buffer-name)) (previous-buffer))
  (when (string= "*Ibuffer*" (buffer-name)) (previous-buffer))
  (when (string-match "TAGS.*" (buffer-name)) (previous-buffer))
  (when (string-match "\*helm.*\*" (buffer-name)) (previous-buffer)))

(ad-activate 'previous-buffer)

(global-set-key [C-prior] 'previous-buffer)
(global-set-key [C-next] 'next-buffer)

#+end_src


** Compilation

#+begin_src emacs-lisp

(global-set-key [f7] 'compile)

#+end_src


** Shell

#+begin_src emacs-lisp

(global-set-key (kbd "C-|") 'shell-command-on-region)

(global-set-key (kbd "s-!") 'shell)
(global-set-key (kbd "s-t") 'term)

(global-set-key (kbd "C-!") 'eshell)

#+end_src


** Date

#+begin_src emacs-lisp

(global-set-key (kbd "s-d") 'insertion-date)
(global-set-key (kbd "H-d") 'insertion-date-jour)

#+end_src


** Caractères

#+begin_src emacs-lisp

(global-unset-key (kbd "<f5>"))

(global-set-key (kbd "<f5> SPC") (lambda () (interactive) (insert " ")))

(global-set-key (kbd "H-s-a") (lambda () (interactive) (insert "⟻")))
(global-set-key (kbd "H-s-z") (lambda () (interactive) (insert "⟼")))

;(global-set-key (kbd "<f5> -") (lambda () (interactive) (insert "⟼")))
;(global-set-key (kbd "<f5> =") (lambda () (interactive) (insert "⟻")))

(global-set-key (kbd "<f5> a") (lambda () (interactive) (insert "â")))
(global-set-key (kbd "<f5> e") (lambda () (interactive) (insert "ê")))
(global-set-key (kbd "<f5> i") (lambda () (interactive) (insert "î")))
(global-set-key (kbd "<f5> o") (lambda () (interactive) (insert "ô")))
(global-set-key (kbd "<f5> u") (lambda () (interactive) (insert "û")))

#+end_src


** Vue restreinte sur un tampon (narrowing)

#+begin_src emacs-lisp

(global-set-key (kbd "s-à") 'narrow-to-region)

#+end_src


** Souris

#+begin_src emacs-lisp

(global-set-key [down-mouse-2]   'mouse-flash-position-or-M-x)
(global-set-key [S-down-mouse-2] 'mouse-scan-lines-or-M-:)

#+end_src


* Macros enregistrées

#+begin_src emacs-lisp

;; (fset 'efface-tag-fin-ligne
;;    (lambda (&optional arg) "Keyboard macro." (interactive "p")
;;      (kmacro-exec-ring-item (quote ([5 23 backspace backspace] 0 "%d")) arg)))
;;
;; (fset 'efface-tag-debut-ligne
;;    (lambda (&optional arg) "Keyboard macro." (interactive "p")
;;       (kmacro-exec-ring-item (quote ([134217747 94 60 return 1 134217828 134217828 134217828 4 4] 0 "%d")) arg)))
;;
;; (fset 'efface-tag
;;    (lambda (&optional arg) "Keyboard macro." (interactive "p")
;;       (kmacro-exec-ring-item (quote ([19 60 return 2 134217828 134217828 134217828 4 4] 0 "%d")) arg)))
;;
;; (fset 'remplace-tag-par-italique
;;    (lambda (&optional arg) "Keyboard macro." (interactive "p")
;;       (kmacro-exec-ring-item (quote ([19 60 return 2 134217828 134217828 134217828 4 4 47 19 60 2 134217828 4 47] 0 "%d")) arg)))
;;
;; (global-set-key (kbd "C-x C-k 0") 'efface-tag-fin-ligne)
;; (global-set-key (kbd "C-x C-k 1") 'efface-tag-debut-ligne)
;; (global-set-key (kbd "C-x C-k 2") 'efface-tag)
;; (global-set-key (kbd "C-x C-k 3") 'remplace-tag-par-italique)

#+end_src


* Compilation bytecode

Désactivé car induisant parfois en erreur.

#+begin_src emacs-lisp

;;(require 'bytecomp)

;;(byte-recompile-directory "~/racine/config/edit/emacs" 0)

#+end_src


* Configuration des paquets


** Fonctions


*** Rename modeline

À quoi ça sert ?

#+begin_src emacs-lisp

(defmacro rename-modeline (package-name mode new-name)
  `(eval-after-load ,package-name
     '(defadvice ,mode (after rename-modeline activate)
        (setq mode-name ,new-name))))

#+end_src


** Organisation


*** Outline

#+begin_src emacs-lisp

(require 'outline)

(eval-after-load "outline" '(require 'foldout))

;(setq outline-minor-mode-prefix (kbd "C-c C-c"))

(global-set-key (kbd "s-o n") 'outline-next-visible-heading)
(global-set-key (kbd "s-o p") 'outline-previous-visible-heading)
(global-set-key (kbd "s-o f") 'outline-forward-same-level)
(global-set-key (kbd "s-o b") 'outline-backward-same-level)
(global-set-key (kbd "s-o u") 'outline-up-heading)

(global-set-key (kbd "s-o c") 'hide-entry)
(global-set-key (kbd "s-o e") 'show-entry)
(global-set-key (kbd "s-o d") 'hide-subtree)
(global-set-key (kbd "s-o s") 'show-subtree)
(global-set-key (kbd "s-o l") 'hide-leaves)
(global-set-key (kbd "s-o k") 'show-branches)
(global-set-key (kbd "s-o i") 'show-children)
(global-set-key (kbd "s-o t") 'hide-body)
(global-set-key (kbd "s-o a") 'show-all)
(global-set-key (kbd "s-o q") 'hide-sublevels)
(global-set-key (kbd "s-o o") 'hide-others)

(global-set-key (kbd "s-o z") 'foldout-zoom-subtree)
(global-set-key (kbd "s-o x") 'foldout-exit-fold)

#+end_src


**** Outline-magic

#+begin_src emacs-lisp

(add-hook 'outline-minor-mode-hook
          (lambda ()
            (require 'outline-magic)
            (define-key outline-minor-mode-map (kbd "TAB") 'outline-cycle)))

#+end_src


*** Org-mode

#+begin_src emacs-lisp

(require 'org)

#+end_src


**** Options

#+begin_src emacs-lisp

(setq org-use-speed-commands t)

(setq org-adapt-indentation nil)

(setq org-list-use-circular-motion t)

(setq org-archive-location "~/racine/plain/orgdir/archive.org::* Fichier %s")

(setq org-export-preserve-breaks nil)

#+end_src


**** Org goto

#+begin_src emacs-lisp

(setq org-directory "~/racine/plain/orgdir/")

(setq org-goto-auto-isearch nil)

(setq org-goto-interface 'outline-path-completionp)
(setq org-outline-path-complete-in-steps nil)

#+end_src


**** Bindings

#+begin_src emacs-lisp

(defun org-super-retour ()
 "Passer une ligne avant Meta-return"
 (interactive)
 (org-meta-return)
 (beginning-of-visual-line)
 (newline)
 (end-of-visual-line)
 )

(add-hook
 'org-mode-hook
 '(lambda ()
    (define-key org-mode-map (kbd "s-§") 'org-goto)
    (define-key org-mode-map (kbd "C-c l") 'org-store-link)
    (define-key org-mode-map (kbd "C-c a") 'org-agenda)
    (define-key org-mode-map (kbd "C-c c") 'org-capture)
    (define-key org-mode-map (kbd "C-c b") 'org-iswitchb)
    (define-key org-mode-map (kbd "<s-return>") 'org-super-retour)
    )
 )

#+end_src


**** Modules

#+begin_src emacs-lisp

(org-babel-do-load-languages
  'org-babel-load-languages
  '(
    (emacs-lisp . t)
    (shell t)
    (org t)
    (lilypond t)
    (octave t)
    ))

(require 'org-checklist)

(require 'org-tempo)

(require 'evil-org)

(evil-org-set-key-theme '(textobjects insert navigation additional shift todo heading))

#+end_src


**** Exportation

#+begin_src emacs-lisp

(with-eval-after-load 'ox
  (require 'ox-pandoc))

(setq org-publish-project-alist
'(("Mon Super Site"
 :base-directory "~/racine/site/orgmode"
 :base-extension "org"
 :publishing-directory "~/racine/site/publish"
 :recursive t
 :publishing-function org-twbs-publish-to-html
 :headline-levels 6             ; Just the default for this project.
 :auto-preamble t
 ))
)

;;  :publishing-function org-html-publish-to-html

#+end_src


**** Agenda

Voir C-c [ & C-c ] pour la gestion de org-agenda-files

#+begin_src emacs-lisp

(setq org-agenda-span 30)

(setq org-agenda-start-on-weekday nil)

(setq org-agenda-start-day "-7d")

(setq org-agenda-include-diary nil)

#+end_src


**** Liste de choses à faire

#+begin_src emacs-lisp

(setq org-treat-S-cursor-todo-selection-as-state-change nil)

;; (setq org-use-fast-todo-selection t)

;; (setq org-todo-keywords
;;       (quote
;;        ((sequence "TODO(t!)" "DONE(d!)" "MAYBE(m!)" "WAIT(w@/!)" "|" "CANCELLED(c@)"))))

#+end_src


**** Capture

#+begin_src emacs-lisp

(setq org-default-notes-file "~/racine/plain/orgdir/notes.org")

(setq org-capture-templates
      '(("a" "Agenda" entry (file+olp "~/racine/plain/orgdir/agenda.org" "Agenda" "Ordinaires")
             "\n\n* %?\n\nCréé le : %U\n\nLien : %a\n\n%i")
	("t" "Todo : Liste de tâches" entry (file+headline "~/racine/plain/orgdir/taches.org" "Tâches")
             "\n\n* TODO %?\n\nCréé le : %U\n\nLien : %a\n\n%i")
        ("f" "Fix : Astuces, résolution de bugs" entry (file+headline "~/racine/plain/orgdir/astuces.org" "Astuces")
             "\n\n* %?\n\nCréé le : %U\n\nLien : %a\n\n%i")
        ("l" "Log : Journal de bord du capitaine" entry (file+olp+datetree "~/racine/plain/orgdir/journaldebord.org" "Journal")
         "\n\n* %?\n\nCréé le %U\n\nLien : %a\n\n%i")
        ("n" "Notes" entry (file+headline "~/racine/plain/orgdir/notes.org" "Notes")
             "\n\n* %?\n\nCréé le : %U\n\nLien : %a\n\n%i")))

#+end_src


**** Refile

#+begin_src emacs-lisp

(setq org-refile-targets '((nil :maxlevel . 9) (org-agenda-files :maxlevel . 9)))

(setq org-refile-use-outline-path t)                  ; Show full paths for refiling

#+end_src


**** Présentation

#+begin_src emacs-lisp

(setq org-list-demote-modify-bullet
      '(("-" . "+") ("+" . "*") ("*" . "-")))

;; use org-bullets-mode for utf8 symbols as org bullets

;;(require 'org-bullets)

;; make available "org-bullet-face" such that I can control the font size individually

(setq org-bullets-face-name (quote org-bullet-face))

(add-hook 'org-mode-hook (lambda () (org-bullets-mode 1)))

(setq org-bullets-bullet-list '("☯" "☰" "☱" "☲" "☳" "☴" "☵" "☶" "☷"))

(add-hook 'org-mode-hook (lambda () (org-bullets-mode 1)))

#+end_src


*** Alert

#+begin_src emacs-lisp

(setq alert-default-style 'libnotify)

;; (setq alert-default-style 'mode-line)

;; (setq alert-default-style 'fringe)

;; (setq alert-default-style 'message)

(setq alert-fade-time 30)

(setq alert-persist-idle-time 900)

#+end_src


*** Org-alert

#+begin_src emacs-lisp

(require 'org-alert)

(org-alert-enable)

(setq org-alert-interval 300)

(setq org-alert-headline-regexp "\\(Sched.+:.+\\|Deadline:.+\\)")

#+end_src


*** Org-wild-notifier

#+begin_src emacs-lisp

(require 'org-wild-notifier)

(org-wild-notifier-mode)

(setq org-wild-notifier-alert-time 10)

(setq org-wild-notifier-alert-times-property "WILD_NOTIFIER_NOTIFY_BEFORE")

(setq org-wild-notifier--day-wide-events t)

#+end_src


** Modes


*** Key-chord

#+begin_src emacs-lisp

;(key-chord-mode 1)

(setq key-chord-one-key-delay 0.2)
(setq key-chord-two-keys-delay 0.1)

(global-set-key (kbd "<f12> k") 'key-chord-mode)

#+end_src

Exemples :

#+begin_src emacs-lisp

(key-chord-define-global "uu" 'undo)

#+end_src


*** Hydra

Mouvements

#+begin_src emacs-lisp

(defhydra hydra-move ()
   "move"
   ;; ("n" next-line)
   ;; ("p" previous-line)
   ;; ("f" forward-char)
   ;; ("b" backward-char)
   ;; ("a" beginning-of-line)
   ;; ("e" move-end-of-line)
   ;; ("F" forward-word)
   ;; ("B" backward-word)
   ;; ("A" backward-sentence)
   ;; ("E" forward-sentence)
   ;; ("v" scroll-up-command)
   ;; ("V" scroll-down-command)
   ("<kp-6>" forward-word)
   ("<kp-4>" backward-word)
   ("<kp-7>" backward-sentence)
   ("<kp-1>" forward-sentence)
   ("<kp-8>" backward-paragraph)
   ("<kp-2>" forward-paragraph)
   ("<kp-9>" scroll-down-command)
   ("<kp-3>" scroll-up-command)
   ;; ("r" move-to-window-line-top-bottom)
   ;; ("l" recenter-top-bottom)
   ("<kp-5>" nil "quit")
   ("q" nil "quit"))

;; (global-set-key (kbd "C-f") #'hydra-move/forward-char)
;; (global-set-key (kbd "C-b") #'hydra-move/backward-char)

;; (global-set-key (kbd "M-f") #'hydra-move/forward-word)
;; (global-set-key (kbd "M-b") #'hydra-move/backward-word)

(global-set-key (kbd "<C-up>") #'hydra-move/backward-paragraph)
(global-set-key (kbd "<C-down>") #'hydra-move/forward-paragraph)

;; (global-set-key (kbd "C-n") #'hydra-move/next-line)
;; (global-set-key (kbd "C-p") #'hydra-move/previous-line)
;; (global-set-key (kbd "C-f") #'hydra-move/forward-char)
;; (global-set-key (kbd "C-b") #'hydra-move/backward-char)
;; (global-set-key (kbd "M-f") #'hydra-move/forward-word)
;; (global-set-key (kbd "M-b") #'hydra-move/backward-word)
;; (global-set-key (kbd "C-a") #'hydra-move/beginning-of-line)
;; (global-set-key (kbd "C-e") #'hydra-move/move-end-of-line)
;; (global-set-key (kbd "M-a") #'hydra-move/backward-sentence)
;; (global-set-key (kbd "M-e") #'hydra-move/forward-sentence)
;; (global-set-key (kbd "<C-up>") #'hydra-move/backward-paragraph)
;; (global-set-key (kbd "<C-down>") #'hydra-move/forward-paragraph)
;; (global-set-key (kbd "C-v") #'hydra-move/scroll-up-command)
;; (global-set-key (kbd "M-v") #'hydra-move/scroll-down-command)

;; (global-set-key (kbd "<prior>") #'hydra-move/scroll-down-command)
;; (global-set-key (kbd "<next>") #'hydra-move/scroll-up-command)

#+end_src

Copier & Coller

#+begin_src emacs-lisp

(defhydra hydra-yank-pop ()
  "yank"
  ("C-y" yank nil)
  ("M-y" yank-pop nil)
  ("y" (yank-pop 1) "next")
  ("Y" (yank-pop -1) "prev")
  ("l" helm-show-kill-ring "list" :color red))   ; or browse-kill-ring

(global-set-key (kbd "M-y") #'hydra-yank-pop/yank-pop)
(global-set-key (kbd "C-y") #'hydra-yank-pop/yank)

#+end_src

Transposition (échange de caractères, mots, ...)

#+begin_src emacs-lisp

(global-set-key (kbd "C-c t")
    (defhydra hydra-transpose (:color red)
    "Transpose"
     ("c" transpose-chars "characters")
     ("w" transpose-words "words")
     ("o" org-transpose-words "Org mode words")
     ("l" transpose-lines "lines")
     ("s" transpose-sentences "sentences")
     ("e" org-transpose-elements "Org mode elements")
     ("p" transpose-paragraphs "paragraphs")
     ("t" org-table-transpose-table-at-point "Org mode table")
     ("q" nil "cancel" :color blue)))

#+end_src

Fenêtres

#+begin_src emacs-lisp

;; (when (fboundp 'windmove-default-keybindings) (windmove-default-keybindings))

;; (defhydra hydra-windmove ()
;;    "windmove"
;;    ("k" windmove-up)
;;    ("j" windmove-down)
;;    ("h" windmove-left)
;;    ("l" windmove-right)
;;    ("0" delete-window)
;;    ("1" delete-other-windows)
;;    ("2" split-window-below)
;;    ("3" split-window-right)
;;    ("<kp-0>" delete-window)
;;    ("<kp-1>" delete-other-windows)
;;    ("<kp-2>" split-window-below)
;;    ("<kp-3>" split-window-right)
;;    ("o" other-window))

;; (global-set-key (kbd "C-x o") #'hydra-windmove/other-window)
;; (global-set-key (kbd "C-x 2") #'hydra-windmove/split-window-below)
;; (global-set-key (kbd "C-x 3") #'hydra-windmove/split-window-right)

#+end_src

Ajuster les fenêtres

#+begin_src emacs-lisp

(require 'hydra-examples)

(defhydra hydra-splitter (global-map "s-<")
  "splitter"
  ("h" hydra-move-splitter-left)
  ("j" hydra-move-splitter-down)
  ("k" hydra-move-splitter-up)
  ("l" hydra-move-splitter-right))

#+end_src


*** Region-bindings-mode

#+begin_src emacs-lisp

(region-bindings-mode-enable)

(setq region-bindings-mode-disable-predicates ((lambda () buffer-read-only)))

(define-key region-bindings-mode-map (kbd "C-w") 'kill-region)

(global-set-key (kbd "C-w") 'backward-kill-word)

#+end_src


*** Xah-math-input

#+begin_src emacs-lisp

(require 'xah-math-input)

(global-set-key (kbd "<f12> x") 'xah-math-input-mode)

#+end_src


*** Evil

#+begin_src emacs-lisp

(global-set-key (kbd "<f12> v") 'evil-mode)

;(evil-mode 1)

;(define-key evil-normal-state-map (kbd "<s-z>") 'evil-emacs-state)
;(define-key evil-emacs-state-map (kbd "<s-z>") 'evil-normal-state)

#+end_src


*** Which-key

#+begin_src emacs-lisp

(require 'which-key)

(which-key-mode)

(setq which-key-idle-delay 2.0)

#+end_src


** Exploration


*** Projectile

#+begin_src emacs-lisp

(setq projectile-indexing-method 'alien)

;;(setq projectile-indexing-method 'native)

(setq projectile-enable-caching t)

(setq projectile-completion-system 'helm)

(setq projectile-switch-project-action 'helm-projectile)

(setq projectile-keymap-prefix (kbd "s-p"))

;; (setq projectile-globally-ignored-files '("*.elc"))
;; (setq projectile-globally-ignored-files (append '("*.html" "*.php" "*.pdf") projectile-globally-ignored-files))

;; (setq projectile-globally-ignored-directories '(".git"))
;; (setq projectile-globally-ignored-directories (append '(".hg" ".bzr") projectile-globally-ignored-directories))

(projectile-global-mode)

#+end_src


*** Ivy & Swiper

#+begin_src emacs-lisp

;;(ivy-mode 1)

(global-set-key (kbd "<f12> i") 'ivy-mode)

(eval-after-load "ivy"
 '(progn
   (define-key ivy-minibuffer-map (kbd "s-o")  'ivy-dispatching-done)
   (define-key ivy-minibuffer-map (kbd "M-o")  'ivy-dispatching-done)
   (define-key ivy-minibuffer-map (kbd "C-n")  'ivy-next-line)
   (define-key ivy-minibuffer-map (kbd "C-p")  'ivy-previous-line)
   (define-key ivy-minibuffer-map (kbd "M-<")  'ivy-beginning-of-buffer)
   (define-key ivy-minibuffer-map (kbd "M->")  'ivy-end-of-buffer)
   (define-key ivy-minibuffer-map (kbd "C-v")  'ivy-scroll-up-command)
   (define-key ivy-minibuffer-map (kbd "M-v")  'ivy-scroll-down-command)))

(setq ivy-height 20)

(setq ivy-wrap t)

(setq ivy-count-format "(%d/%d) ")

(setq ivy-use-virtual-buffers t)

(global-set-key (kbd "s-f") 'counsel-find-file)

(global-set-key (kbd "s-b") 'ivy-switch-buffer)

(global-set-key (kbd "s-x") 'counsel-M-x)

(global-set-key (kbd "s-s") 'swiper)

(global-set-key (kbd "H-g") 'counsel-ag)

#+end_src


*** Counsel projectile

#+begin_src emacs-lisp

;;(global-set-key (kbd "s-%") 'counsel-projectile)

#+end_src


*** Helm


**** Options

#+begin_src emacs-lisp

(setq helm-split-window-default-side 'other)

(setq helm-split-window-in-side-p t)

(setq helm-autoresize-mode t)

(setq helm-autoresize-max-height 40)
(setq helm-autoresize-min-height 30)

(setq helm-move-to-line-cycle-in-source t)

(setq helm-quick-update t)

(setq helm-idle-delay 0.01)

(setq helm-input-idle-delay 0.01)

(setq helm-candidate-number-limit 200)

(setq helm-scroll-amount 4)

(setq helm-ff-file-name-history-use-recentf t)

(setq helm-buffers-favorite-modes (append helm-buffers-favorite-modes '(picture-mode artist-mode)))

(setq helm-ff-search-library-in-sexp t)

(loop for ext in
 '("\\.elc$" "\\.pyc$" "\\.git$" "\\.o$" "*~")
 do (add-to-list 'helm-boring-file-regexp-list ext))

(setq helm-mini-default-sources '(
  helm-source-buffers-list
  helm-source-recentf
  helm-source-files-in-current-dir
  helm-source-buffer-not-found
  ))

(setq helm-M-x-requires-pattern 0)

(setq helm-locate-command "locate -d ~/racine/index/locate/racine.db %s -e -A %s")

(setq helm-ack-grep-executable "/usr/bin/vendor_perl/ack")

#+end_src


**** Bindings

#+begin_src emacs-lisp

(global-set-key (kbd "s-h") 'helm-command-prefix)

(global-unset-key (kbd "C-x c"))

(define-key global-map [remap find-file] 'helm-find-files)
(define-key global-map [remap occur] 'helm-occur)
(define-key global-map [remap dabbrev-expand] 'helm-dabbrev)
(define-key global-map [remap bookmark-bmenu-list] 'helm-filtered-bookmarks)
(define-key global-map [remap insert-register] 'helm-register)

(global-set-key (kbd "s-SPC") 'helm-mini)
(key-chord-define-global "bn" 'helm-mini)

(key-chord-define-global "df" 'helm-find-files)

(global-set-key (kbd "M-x") 'helm-M-x)
(key-chord-define-global "xc" 'helm-M-x)

; Même idée qu’occur

(global-set-key (kbd "s-é") 'helm-swoop)
(global-set-key (kbd "s-è") 'helm-multi-swoop)

(global-set-key (kbd "s-ç") 'helm-show-kill-ring)

(global-set-key (kbd "M-s l") 'swiper-helm)

(global-set-key (kbd "s-$") 'helm-etags-select)
(global-set-key (kbd "s--") 'helm-locate)

(global-set-key (kbd "H-&") 'helm-do-grep-ag)

(global-set-key (kbd "s-'") 'helm-all-mark-rings)

(global-set-key (kbd "s-m") 'helm-filtered-bookmarks)

(global-set-key (kbd "s-^") 'helm-gid)

(global-set-key (kbd "s-h y") 'helm-show-kill-ring)
(global-set-key (kbd "s-h :") 'helm-mini-buffer-history)
(global-set-key (kbd "s-h '") 'helm-all-mark-rings)

#+end_src


**** Bindings locaux au tampon helm

#+begin_src emacs-lisp

(define-key helm-map (kbd "s-z")  'helm-select-action)
(define-key helm-map (kbd "C-z") 'helm-execute-persistent-action)

;;(helm-mode 1)

(global-set-key (kbd "<f12> h") 'helm-mode)

#+end_src


*** Helm ag

#+begin_src emacs-lisp

(global-set-key (kbd "s-g") 'helm-ag)

#+end_src


*** Helm projectile

#+begin_src emacs-lisp

(require 'helm-projectile)

(global-set-key (kbd "s-ù") 'helm-projectile)
(global-set-key (kbd "s-*") 'helm-projectile-find-file)

(global-set-key (kbd "H-SPC") 'helm-projectile-recentf)

(global-set-key (kbd "s-p s-f") 'helm-projectile-find-file-in-known-projects)

(helm-projectile-on)

#+end_src


*** Helm gtags

#+begin_src emacs-lisp

(global-set-key (kbd "H-$") 'helm-gtags-find-pattern)

(setq
 helm-gtags-ignore-case t
 helm-gtags-auto-update t
 helm-gtags-use-input-at-cursor t
 helm-gtags-pulse-at-cursor t
 helm-gtags-prefix-key "\C-cg"
 helm-gtags-suggested-key-mapping t
 )

(require 'helm-gtags)

#+end_src


*** Ggtags

#+begin_src emacs-lisp

(global-set-key (kbd "<f12> g") 'ggtags-mode)

(global-set-key (kbd "s-q") 'ggtags-idutils-query)

(setq ggtags-completing-read-function nil)

#+end_src


*** MTorus

#+begin_src emacs-lisp

(require 'mtorus)
(mtorus-init)

;; (mtorus-install-suggested-bindings)

(global-set-key (kbd "H-= c") 'mtorus-new-ring)
(global-set-key (kbd "H-= m") 'mtorus-rename-ring)
(global-set-key (kbd "H-= d") 'mtorus-delete-ring)

(global-set-key (kbd "H-= u") 'mtorus-update-current-marker)

(global-set-key (kbd "H-= p") 'mtorus-describe-current-ring)

(global-set-key (kbd "H-= s") 'mtorus-save-torus)
(global-set-key (kbd "H-= r") 'mtorus-read-torus)

(global-set-key (kbd "s-=") 'mtorus-switch-to-ring)

(global-set-key (kbd "<s-insert>") 'mtorus-add-current-pos-to-current-ring)
(global-set-key (kbd "<s-delete>") 'mtorus-delete-current-marker-from-current-ring)

(global-set-key (kbd "<H-insert>") 'mtorus-update-current-marker)

(global-set-key (kbd "<s-home>") 'mtorus-cycle-ring-next)
(global-set-key (kbd "<s-end>") 'mtorus-cycle-ring-previous)

(global-set-key (kbd "<s-prior>") 'mtorus-cycle-marker-previous)
(global-set-key (kbd "<s-next>") 'mtorus-cycle-marker-next)

;; (global-set-key [C-prior] 'mtorus-cycle-blist-prev)
;; (global-set-key [C-next] 'mtorus-cycle-blist-next)

(setq mtorus-save-on-exit t)
(setq mtorus-file-name "~/racine/plugin/data/mtorus/mtorus.el")

;; (mtorus-read-torus)

#+end_src


*** Ibuffer-vc

#+begin_src emacs-lisp

(add-hook 'ibuffer-hook
  (lambda ()
    (ibuffer-vc-set-filter-groups-by-vc-root)
    (unless (eq ibuffer-sorting-mode 'alphabetic)
      (ibuffer-do-sort-by-alphabetic))))

#+end_src


** Complétion


*** Auto-complete

#+begin_src emacs-lisp

(ac-config-default)

(setq-default ac-sources '(
  ac-source-words-in-same-mode-buffers
  ac-source-filename
  ac-source-dictionary
  ac-source-abbrev
  ac-source-gtags
  ac-source-yasnippet
))

(add-to-list 'ac-modes 'org-mode)

(setq ac-expand-on-auto-complete nil)

(setq ac-use-comphist t)

(setq ac-comphist-file "~/racine/dotdir/emacs/ac-comphist")

(setq ac-candidate-limit 500)

(setq ac-use-menu-map t)

(setq ac-auto-start 15)

(setq ac-auto-show-menu 3.0)

(setq ac-menu-height 10)

(ac-set-trigger-key "s-n")

(define-key ac-menu-map "\C-n" 'ac-next)
(define-key ac-menu-map "\C-p" 'ac-previous)

(append ac-user-dictionary-files '("~/racine/index/spell/dictionnaire.txt"))

#+end_src


** Annulation


*** Undo-tree

#+begin_src emacs-lisp

(setq undo-tree-auto-save-history t)

;;(setq undo-tree-visualizer-timestamps t)

(defconst perso-undo-dir (expand-file-name "~/racine/varia/undo/"))
(setq undo-tree-history-directory-alist `((".*" . ,perso-undo-dir)))

(key-chord-define-global "yu" 'undo-tree-visualize)

(global-undo-tree-mode 1)

(global-set-key (kbd "<f12> u") 'global-undo-tree-mode)

#+end_src


**** Keep region when undoing in region

#+begin_src emacs-lisp

;; (defadvice undo-tree-undo (around keep-region activate)
;;   (if (use-region-p)
;;       (let ((m (set-marker (make-marker) (mark)))
;;             (p (set-marker (make-marker) (point))))
;;         ad-do-it
;;         (goto-char p)
;;         (set-mark m)
;;         (set-marker p nil)
;;         (set-marker m nil))
;;     ad-do-it))

#+end_src


** Registres


*** Register list

#+begin_src emacs-lisp

;;(require 'register-list)

(global-set-key (kbd "C-x r L") 'register-list)

#+end_src


** Édition multiple


*** Multiple cursors (mc)

#+begin_src emacs-lisp

(define-key region-bindings-mode-map (kbd "<s-return>") 'mc/mark-next-like-this)

(define-key region-bindings-mode-map (kbd "<H-return>") 'mc/mark-all-like-this)

(define-key region-bindings-mode-map (kbd "H-SPC") 'mc/mark-more-like-this-extended)

(define-key region-bindings-mode-map (kbd "H-=") 'mc/edit-lines)

#+end_src


** Déplacement


*** Iy-go-to-char

#+begin_src emacs-lisp

(global-set-key (kbd "s-;") 'iy-go-to-char)
(global-set-key (kbd "s-,") 'iy-go-to-char-backward)

(global-set-key (kbd "H-;") 'iy-go-to-or-up-to-continue)
(global-set-key (kbd "H-,") 'iy-go-to-or-up-to-continue-backward)

#+end_src


** Parenthèses


*** Smartparens

#+begin_src emacs-lisp

(require 'smartparens)

(smartparens-global-mode t)

(show-smartparens-global-mode t)

(require 'smartparens-config)

(sp-local-pair 'minibuffer-inactive-mode "'" nil :actions nil)

#+end_src


**** Bindings

#+begin_src emacs-lisp

(global-set-key (kbd "<f12> p") 'smartparens-global-mode)

(define-key smartparens-mode-map (kbd "C-M-f") 'sp-forward-sexp)
(define-key smartparens-mode-map (kbd "C-M-b") 'sp-backward-sexp)

(define-key smartparens-mode-map (kbd "C-M-n") 'sp-next-sexp)
(define-key smartparens-mode-map (kbd "C-M-p") 'sp-previous-sexp)

(define-key smartparens-mode-map (kbd "C-M-<down>") 'sp-down-sexp)
(define-key smartparens-mode-map (kbd "C-M-<up>") 'sp-up-sexp)

(define-key smartparens-mode-map (kbd "C-M-d") 'sp-backward-down-sexp)
(define-key smartparens-mode-map (kbd "C-M-u") 'sp-backward-up-sexp)

(define-key smartparens-mode-map (kbd "C-S-f") 'sp-forward-symbol)
(define-key smartparens-mode-map (kbd "C-S-b") 'sp-backward-symbol)

(define-key smartparens-mode-map (kbd "C-<right>") 'sp-forward-slurp-sexp)
(define-key smartparens-mode-map (kbd "H-<right>") 'sp-forward-barf-sexp)
(define-key smartparens-mode-map (kbd "C-<left>") 'sp-backward-slurp-sexp)
(define-key smartparens-mode-map (kbd "H-<left>") 'sp-backward-barf-sexp)

(define-key smartparens-mode-map (kbd "C-s-t") 'sp-transpose-sexp)
(define-key smartparens-mode-map (kbd "H-t") 'sp-transpose-hybrid-sexp)

(define-key smartparens-mode-map (kbd "M-]") 'sp-unwrap-sexp)
(define-key smartparens-mode-map (kbd "M-[") 'sp-backward-unwrap-sexp)

(define-key smartparens-mode-map (kbd "C-M-k") 'sp-kill-sexp)
(define-key smartparens-mode-map (kbd "H-k") 'sp-kill-hybrid-sexp)

(define-key smartparens-mode-map (kbd "M-D") 'sp-splice-sexp)

(define-key smartparens-mode-map (kbd "H-<delete>") 'sp-splice-sexp-killing-forward)
(define-key smartparens-mode-map (kbd "H-<backspace>") 'sp-splice-sexp-killing-backward)
(define-key smartparens-mode-map (kbd "C-H-<backspace>") 'sp-splice-sexp-killing-around)

(define-key smartparens-mode-map (kbd "s-|") 'sp-split-sexp)

(define-key smartparens-mode-map (kbd "s-]") 'sp-select-next-thing-exchange)
(define-key smartparens-mode-map (kbd "s-[") 'sp-select-previous-thing)
(define-key smartparens-mode-map (kbd "C-s-]") 'sp-select-next-thing)

#+end_src


** Recherche


*** Wgrep

#+begin_src emacs-lisp

(require 'wgrep)

(setq wgrep-auto-save-buffer t)

(setq wgrep-enable-key "e")

#+end_src


** Arborescence du système de fichiers


*** Dired-hacks

#+begin_src emacs-lisp

(require 'dired-filter)

(define-key dired-mode-map (kbd "/") dired-filter-map)

(define-key dired-mode-map (kbd "_") dired-filter-mark-map)

;; (setq dired-filter-group-saved-groups '(("defaut"
;;   ("Org" (extension . "org"))
;;   ("Lisp" (extension . "el"))
;;   ("LaTeX" (extension "tex" "bib"))
;;   ("PDF" (extension . "pdf"))
;;   ("Archives" (extension "zip" "rar" "gz" "bz2" "tar")))))

(define-key dired-mode-map (kbd "_ _") dired-filter-group-mode)

#+end_src


** Sélection


*** Expand-region

#+begin_src emacs-lisp

(global-set-key (kbd "s-e") 'er/expand-region)

#+end_src


** Unicode


** Ucs-cmds

#+begin_src emacs-lisp

;; (require 'ucs)

;; (set-frame-font "DejaVu Sans Mono-10")
;; (set-frame-font "DejaVu Sans 10")
;; (set-frame-font "Arial Unicode MS")

;; (ucsc-make-commands "^math")
;; (ucsc-make-commands "latin")
;; (ucsc-make-commands "arabic")
;; (ucsc-make-commands "^cjk")
;; (ucsc-make-commands "^box drawings ")
;; (ucsc-make-commands "^greek [a-z]+ letter")
;; (ucsc-make-commands "\\(^hangul\\|^circled hangul\\|^parenthesized hangul\\)")

#+end_src


** Async

#+begin_src emacs-lisp

(autoload 'dired-async-mode "dired-async.el" nil t)

(dired-async-mode 1)

(async-bytecomp-package-mode 1)

#+end_src


** Présentation


*** Powerline

#+begin_src emacs-lisp

;; (powerline-vim-theme)
(powerline-evil-vim-theme)
;; (powerline-nano-theme)
;; (powerline-center-theme)
;; (powerline-center-evil-theme)
;; (powerline-default-theme)

#+end_src


* Fin

Nécessaire pour éviter un stack overflow lors du chargement du fichier.
