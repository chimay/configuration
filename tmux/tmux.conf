# vim: set filetype=tmux.conf :

# Adaptation des exemples dans /usr/share/doc/tmux/examples

# {{{ Aide

bind 'a' list-keys

# }}}

# {{{ Terminal

set -g default-terminal "tmux-256color"

# }}}

# {{{ Encodage

set -g xterm-keys on

# }}}

# {{{ Titre

set -g set-titles on
set -g set-titles-string '#h-#S-#W-#P-#T'

# }}}

# {{{ Commande par défaut

# Commande par défaut pour :
#
# 	* les nouvelles sessions
# 	* les nouvelles fenêtres
# 	* les nouveaux panels

#set -g default-command 'zsh'

# Shell

#set -g default-shell 'zsh'

# }}}

# {{{ Commande en arrière-plan

bind '&' command-prompt -p 'Commande à lancer ? ' "run-shell -b '%%'"

# }}}

# {{{ Préfixe

unbind C-b

set -g prefix F1

bind F12 send-prefix

# Répétition sans préfixe

set -g repeat-time 1275

# }}}

# {{{ Escape, Alt, Méta

set -s escape-time 120

# }}}

# {{{ Statut

bind 'b' set-option status

set -g display-time 1234

set -g status on

set -g status-interval 15

set -g status-justify centre

set -g status-left-length 36
set -g status-right-length 36

set -g status-style "fg=#B36700"

set -g status-left " #S / #W / #P #{prefix_highlight}"

set -g status-right ' %H:%M %A %d %B %Y'

set -g status-fg '#B36700'

set -g status-bg 'black'

set -g status-left-fg '#B36700'

set -g status-left-bg 'black'

set -g status-right-fg '#B36700'

set -g status-right-bg 'black'

# }}}

# {{{ Ligne de commande

bind ':' command-prompt -p 'tmux :'

setw -g status-keys emacs

set -g message-fg '#B36700'

set -g message-bg '#070707'

set -g message-attr dim

set -g message-command-fg green
set -g message-command-bg black

# }}}

# {{{ Sauvegarde dans un fichier

bind-key é command-prompt -p 'save history to filename:' -I '~/racine/hist/tmux/#h-#S-#W-#P.history' 'capture-pane -S - ; save-buffer %1 ; delete-buffer'

# {{{ Canalise la sortie d’un panel

# Active / Désactive la copie de la sortie vers un fichier

bind-key è pipe-pane -o 'cat >> ~/racine/hist/tmux/#h-#S-#W-#P.pipe'

# }}}

# }}}

# {{{ Messages

bind 'i' show-messages

set -g message-limit 84

# }}}

# {{{ Monitoring

set -g bell-action any

set -g visual-bell on

#set -g visual-content on

set -g visual-activity on
set -g visual-silence on

#set -g window-status-bell-attr underscore,blink
#set -g window-status-bell-attr underscore
set -g window-status-bell-attr blink
set -g window-status-bell-fg '#D90115'
set -g window-status-bell-bg black

#set -g window-status-activity-attr underscore,blink
#set -g window-status-activity-attr underscore
set -g window-status-activity-attr blink
set -g window-status-activity-fg '#D90115'
set -g window-status-activity-bg black

#set -g window-status-content-attr underscore,blink
#set -g window-status-content-attr underscore
#set -g window-status-content-attr blink
#set -g window-status-content-fg '#F7230C'
#set -g window-status-content-bg black

# }}}

# {{{ Historique

set -g history-limit 84712

# Ligne de commande

set -g history-file ~/racine/hist/tmux/cmdline-$HOST

# }}}

# {{{ Verrouillage

set -g lock-command "vlock -c"
#set -g lock-command "cmatrix -s -a -b -u 3 -C green"

#set -g lock-after-time 1800

unbind M-l
bind M-l lock-client

# }}}

# {{{ Navigation

bind '§' choose-tree

# }}}

# {{{ Sessions

bind 'M-m' command-prompt -p 'Nouveau nom de la session ? ' "rename-session '%%'"

bind 'd' detach-client

# Précédente, Suivante

bind '{' switch-client -p
bind '}' switch-client -n

# Nouvelle session

bind M-n command-prompt -p 'Nom de la nouvelle session ? ' "new-session -s '%%'"

# {{{ Options

set -s exit-unattached off

set -g destroy-unattached off
set -g detach-on-destroy on

# }}}

# }}}

# {{{ Fenêtres

bind 'n' new-window

bind 'M-n' command-prompt -p 'Commande de la nouvelle fenêtre ? ' "new-window '%%'"

bind 'm' command-prompt -p 'Nouveau nom de la fenêtre ? ' "rename-window '%%'"

# {{{ Précédente, Suivante

bind -n C-PageUp previous-window
bind -n C-PageDown next-window

# }}}

# {{{ 1 à 10

bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5
bind -n M-6 select-window -t 6
bind -n M-7 select-window -t 7
bind -n M-8 select-window -t 8
bind -n M-9 select-window -t 9
bind -n M-0 select-window -t 10

# }}}

# {{{ Déplacement

bind '(' move-window -t :-1
bind ')' move-window -t :+1

# }}}

# {{{ Options

set -g base-index 1

set -g allow-rename on
set -g alternate-screen on
set -g automatic-rename on

# }}}

# }}}

# {{{ Panels (sous-fenêtres)

# {{{ Split

bind 'h' split-window -h
bind 'v' split-window -v

bind M-h command-prompt -p 'Commande pour le nouveau panel ? ' "split-window -h '%%'"
bind M-v command-prompt -p 'Commande pour le nouveau panel ? ' "split-window -v '%%'"

bind 'H' split-window -h -c '#{pane_current_path}'
bind 'V' split-window -v -c '#{pane_current_path}'

# }}}

# {{{ Mouvements

bind "'" display-panes

bind -n C-Left  select-pane -L
bind -n C-Down  select-pane -D
bind -n C-Up    select-pane -U
bind -n C-Right select-pane -R

set -g display-panes-time 84712

# }}}

# {{{ Redimensionnement

bind -r + resize-pane -U 2
bind -r - resize-pane -D 2
bind -r < resize-pane -L 2
bind -r > resize-pane -R 2

# }}}

# {{{ Échange & Rotation

bind '[' swap-pane -U
bind ']' swap-pane -D

bind -n 'C-Home' rotate-window -D
bind -n 'C-End' rotate-window -U

# }}}

# {{{ Options

set -g pane-base-index 1

# }}}

# }}}

# {{{ Recherche

bind '/' command-prompt -p 'Recherche de la fenêtre ? ' "find-window '%%'"

# }}}

# {{{ Mode copie

set -g assume-paste-time 1

setw -g mode-keys vi

set -s buffer-limit 30

# {{{ Bindings

bind 'F1' copy-mode

bind 'p' paste-buffer

bind 'r' list-buffers
bind '"' choose-buffer

bind-key -T copy-mode-vi 'v' send -X  begin-selection

# }}}

# {{{ Couleurs de la sélection

set -g mode-attr dim

set -g mode-fg black
set -g mode-bg colour3

# }}}

# Souris

set -g mouse on

# }}}

# {{{ Horloge

set -g clock-mode-style 24

# }}}

# {{{ Quitter

bind-key 'q' confirm kill-pane
bind-key M-q confirm kill-window
bind-key 'Q' confirm kill-session
bind-key C-q confirm kill-server

# }}}

# {{{ Source file

# Rechargement de ce fichier

bind 'F2' source-file ~/racine/config/multiplex/tmux/tmux.conf \; \
		display-message 'Fichier de configuration rechargé'

bind 'F3' command-prompt -p 'Session ? ' "source-file ~/racine/config/multiplex/tmux/session/'%%'.tmux"

# }}}

# {{{ Tmux Plugin Manager

# List of plugins

set -g @plugin 'tmux-plugins/tpm'

set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

set -g @plugin 'tmux-plugins/tmux-urlview'

set -g @plugin 'tmux-plugins/tmux-prefix-highlight'

set -g @plugin 'tmux-plugins/tmux-copycat'
set -g @plugin 'tmux-plugins/tmux-yank'

# Ne fonctionne pas
#set -g @plugin 'tmux-plugins/tmux-open'


# Configuration

set -g @continuum-boot 'on'
set -g @continuum-systemd-start-cmd 'new-session -d'
set -g @continuum-restore 'on'

# clipboard, primary ou secondary
set -g @yank_selection 'clipboard'

set -g @prefix_highlight_output_prefix '[ '
set -g @prefix_highlight_output_suffix ' ]'
set -g @prefix_highlight_show_copy_mode 'on'
set -g @prefix_highlight_fg '1'
set -g @prefix_highlight_bg 'default'
set -g @prefix_highlight_copy_mode_attr 'fg=1,bg=default'

# set -g @open 'o'
# set -g @open-editor 'C-o'
# set -g @open-S 'https://www.duckduckgo.com/'
# set -g @urlview-key 'u'

# Installation automatique

# if "test ! -d ~/.tmux/plugins/tpm" \
#    "run 'git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm && ~/.tmux/plugins/tpm/bin/install_plugins'"

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)

run '~/racine/plugin/manager/tmux-plugins/tpm/tpm'

# }}}
